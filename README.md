# ping360_sonar
[![GitHub stars](https://img.shields.io/github/stars/CentraleNantesRobotics/ping360_sonar.svg?style=social&label=Star&maxAge=2592000)](https://GitHub.com/CentraleNantesRobotics/ping360_sonar/stargazers/)
[![GitHub forks](https://img.shields.io/github/forks/CentraleNantesRobotics/ping360_sonar.svg?style=social&label=Fork&maxAge=2592000)](https://GitHub.com/CentraleNantesRobotics/ping360_sonar/network/)
[![Build Status](https://github.com/CentraleNantesRobotics/ping360_sonar/workflows/ROS%20CI/badge.svg)](https://GitHub.com/CentraleNantesRobotics/ping360_sonar/)
[![GitHub issues](https://img.shields.io/github/issues/CentraleNantesRobotics/ping360_sonar.svg)](https://GitHub.com/CentraleNantesRobotics/ping360_sonar/issues/)
[![GitHub license](https://img.shields.io/github/license/CentraleNantesRobotics/ping360_sonar.svg)](https://github.com/CentraleNantesRobotics/ping360_sonar/blob/master/LICENSE)
[![Github all releases](https://img.shields.io/github/downloads/CentraleNantesRobotics/ping360_sonar/total.svg)](https://GitHub.com/CentraleNantesRobotics/ping360_sonar/releases/)
[![GitHub release](https://img.shields.io/github/release/CentraleNantesRobotics/ping360_sonar.svg)](https://GitHub.com/CentraleNantesRobotics/ping360_sonar/releases/)
[![All Contributors](https://img.shields.io/badge/all_contributors-1-orange.svg?style=flat-square)](#contributors-)
## Overview

A ROS 2 package for the [BlueRobotics] [Ping360] Sonar. This code is being developped for Foxy.

**Keywords:** ROS 2, package, ping360, ping360 emulator

### License

The source code is released under a [MIT license](LICENSE).

## Installation

<!--### Download the latest release

Get the latest stable release [here](https://github.com/CentraleNantesRobotics/ping360_sonar/releases/latest).-->

### Building from Source

#### Dependencies

- [Robot Operating System (ROS)](https://docs.ros.org/en/foxy/) (middleware for robotics),
- [cv_bridge]

#### Building

Clone with `--recursive` in order to get the necessary `ping-cpp` library:

	cd ros2_workspace/src
	git clone https://github.com/CentraleNantesRobotics/ping360_sonar.git -b ros2 --recursive
	cd ../..
	colcon build --symlink-install --packages-select ping360_sonar


## Usage

To run the Python version of the node:
	
	ros2 run ping360_sonar ping360.py
	
To run the C++ version of the node (not usable at this stage):

	ros2 run ping360_sonar ping360_node
	
## Nodes

### ping360.py

While continuously rotating the sonar in a set FOV range (defined by the min and max angle parameters), it publishes two types of messages:
- The sonar's response data (the echo intensities for a given angle & range)
- A LaserScan msg with ranges detected using a certain intensity threshold:
- A black and white image using the date received from the sonar. Same as the one generated by the ping viewer.

#### Published Topics

* **`/ping360_images`** ([sensor_msgs/Image])

	The generated sonar image. 
	This topic can be toggled using the **enableImageTopic** parameter.

* **`/ping360_data`** ([msg/SonarEcho])

	Publishes the raw sonar data in a custom message:
	
		Header header            #header info
		float32 angle               # the measurement angle [rad]
		uint8 gain  # Sonar Gain
		uint16 number_of_samples 
		uint16 transmit_frequency # [kHz]
		uint16 speed_of_sound # [m/s]
		uint8 range      #  range value [m]
		uint8[] intensities    # intensity data [0-255].  This is the actual data received from the sonar
	
	This topic can be toggled using the **enableDataTopic** parameter.

* **`/ping360_scan`** ([sensor_msgs/LaserScan])

	Publishes a LaserScan msg with ranges detected above a certain intensity threshold:

		float32 angle_min = minAngle     # start angle of the scan [rad]
		float32 angle_max = maxAngle  # end angle of the scan [rad]
		float32 angle_increment   # angular distance between measurements, calculated using the configured Step  [rad]

		float32 range_min = .75   # minimum range value [m]
		float32 range_max = sonarRange # maximum range value, it's set to the configured sonarRange [m]

		float32[] ranges         # calculated ranges that correspond to an intensity > threshold [m] 
		float32[] intensities    # sensor intensity data [0-255]

	This topic can be toggled using the **enableScanTopic** parameter.

	Note: 
	- ranges values < range_min or > range_max should be discarded
	- don't forget to set the frame to *sonar_frame* when using Rviz

### ping360_node 

Not usable at this stage

## Bugs & Feature Requests

Please report bugs and request features using the [Issue Tracker](https://github.com/CentraleNantesRobotics/ping360_sonar/issues).


[ROS]: http://www.ros.org
[BlueRobotics]: http://bluerobotics.com
[cv_bridge]: http://wiki.ros.org/cv_bridge
[sensor_msgs/Image]: http://docs.ros.org/melodic/api/sensor_msgs/html/msg/Image.html
[Ping360]: https://bluerobotics.com/store/sensors-sonars-cameras/sonar/ping360-sonar-r1-rp/
[msg/SonarEcho]: /msg/SonarEcho.msg
[sensor_msgs/LaserScan]: http://docs.ros.org/melodic/api/sensor_msgs/html/msg/LaserScan.html

## Contributors

<!-- ALL-CONTRIBUTORS-LIST:START - Do not remove or modify this section -->
<!-- prettier-ignore-start -->
<!-- markdownlint-disable -->
<table>
  <tr>
    <td align="center"><a href="https://github.com/oKermorgant"><img src="https://avatars.githubusercontent.com/u/1633173?v=4" width="100px;" alt=""/><br /><sub><b>Olivier Kermorgant</b></sub></a><br /><a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=oKermorgant" title="Code">üíª</a> <a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=oKermorgant" title="Tests">‚ö†Ô∏è</a></td>
    <td align="center"><a href="https://github.com/Hameck"><img src="https://avatars2.githubusercontent.com/u/14954732?v=4" width="100px;" alt=""/><br /><sub><b>Henrique Martinez Rocamora</b></sub></a><br /><a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=Hameck" title="Code">üíª</a> <a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=Hameck" title="Tests">‚ö†Ô∏è</a></td>
    <td align="center"><a href="https://stormix.co"><img src="https://avatars2.githubusercontent.com/u/18377687?v=4" width="100px;" alt=""/><br /><sub><b>Anas Mazouni</b></sub></a><br /><a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=Stormiix" title="Code">üíª</a> <a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=Stormiix" title="Tests">‚ö†Ô∏è</a></td>
    <td align="center"><a href="https://github.com/tomlogan501"><img src="https://avatars3.githubusercontent.com/u/56969577?v=4" width="100px;" alt=""/><br /><sub><b>tomlogan501</b></sub></a><br /><a href="#ideas-tomlogan501" title="Ideas, Planning, & Feedback">ü§î</a> <a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=tomlogan501" title="Tests">‚ö†Ô∏è</a> <a href="https://github.com/CentraleNantesRobotics/ping360_sonar/issues?q=author%3Atomlogan501" title="Bug reports">üêõ</a></td>
    <td align="center"><a href="https://github.com/AlexisFetet"><img src="https://avatars.githubusercontent.com/u/94527511?s=400&u=52455c5dee050e1e9c601f7854450a1fdc9f1aa5&v=4" width="100px;" alt=""/><br /><sub><b>Alexis Fetet</b></sub></a><br /><a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=AlexisFetet" title="Code">üíª</a> <a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=AlexisFetet" title="Tests">‚ö†Ô∏è</a></td>
    <td align="center"><a href="https://github.com/Foukoo"><img src="https://avatars.githubusercontent.com/u/59455485?v=4" width="100px;" alt=""/><br /><sub><b>Jonathan Delacoux</b></sub></a><br /><a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=Foukoo" title="Code">üíª</a> <a href="https://github.com/CentraleNantesRobotics/ping360_sonar/commits?author=Foukoo" title="Tests">‚ö†Ô∏è</a></td>
  </tr>
</table>

<!-- markdownlint-enable -->
<!-- prettier-ignore-end -->
<!-- ALL-CONTRIBUTORS-LIST:END -->

Contributions of any kind welcome! Please refer to our [Contribution Guide](CONTRIBUTING.md)

